<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>电子签名初级方案</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<h1 align="center">电子签名初级方案</h1>

<h1 id="toc_0"></h1>

<h2 id="toc_1">原理</h2>

<h3 id="toc_2">RSA非对称加解密算法</h3>

<p>非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。</p>

<p><a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">RSA算法原理(一)</a></p>

<p><a href="http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">RSA算法原理(二)</a></p>

<h3 id="toc_3">数字证书</h3>

<p><img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmnan3wlwij30x8054aaz.jpg" alt="">
如下图，A有一个公钥和一个私钥，公钥匙公开的谁都可以知道，私钥只有A本人知道，正常情况下A用私钥加密消息，然后B用A的公钥解密消息，两者通讯是安全的，如图：
<img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmnal4xxc5j31jk0dwq6o.jpg" alt="">
但是突然有一天来了一个黑客C,C将B拥有的A公钥换成了自己的公钥，但是B并不知情，B还认为自己拥有的是A的公钥，继续给A发送消息。由于B现在拥有的公钥其实是C的公钥，所以他发送的消息被C截取到后，由于消息是用C的公钥加密的，所以C用自己的私钥就能轻松解密消息，自此C就成功替代A完成了与B的通讯。如下图：</p>

<p><img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmnav5khlkj31ji0s447n.jpg" alt=""></p>

<p>为了解决这个问题B需要一个机构来证明她所拥有的公钥确实是A本人的，而不是C的公钥，就此CA机构应运而生。
<a href="#CA%E9%A2%81%E5%8F%91%E8%AF%81%E4%B9%A6%E8%BF%87%E7%A8%8B">点击查看CA颁发证书过程</a>
通过<a href="#%E9%AA%8C%E8%AF%81%E8%AF%81%E4%B9%A6%E6%9C%89%E6%95%88%E6%80%A7">验证证书有效性</a>B就能够确定自己所拥有的证书是不是真正的A的证书。</p>

<h3 id="toc_4">数字签名</h3>

<p><img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmn9rbez6tj31d80rc7dy.jpg" alt=""></p>

<h3 id="toc_5">CA证书颁发:</h3>

<p><img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmluqk9ni1j319g10oauj.jpg" alt=""></p>

<p><a name="CA颁发证书过程">CA颁发证书简明过程：</a>
<img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmn8ng2deoj317w0q6wjc.jpg" alt=""></p>

<p><a name="验证证书有效性"></a></p>

<h3 id="toc_6">验证证书有效性</h3>

<p><img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmo5b79pm0j31lm0qck0k.jpg" alt=""></p>

<h2 id="toc_7">针对EFB应用方案</h2>

<p>根据中国民用航空局飞行标准司，关于电子签名的咨询通告
5.9节描述：
<code>电子认证服务机构，是指依据《电子签名法》设立，持有中
华人民共和国工业和信息化部颁发且在有效期内的“电子认证服务许可证” ，颁发电子签名认证证书的实体。</code>
6.4描述：
<code>使用单位所使用的电子签名只有满足《电子签名法》中对
可靠电子签名的要求，且符合本咨询通告电子签名标准要求时，才
被局方接受。</code>
6.4.1描述：
<code>电子签名认证证书一般由受信任的第三方机构（如电子
认证服务机构、注册机构）颁发，从而实现对签名人身份的验证。</code></p>

<p>因此个人PDF签名证书必须由符合电子签名法、并且持有中
华人民共和国工业和信息化部颁发且在有效期内的电子认证服务许可证的机构颁发的证书才有效。</p>

<h3 id="toc_8">获得PDF签名证书</h3>

<blockquote>
<p>CA机构</p>

<p>国内： <a href="http://www.cfca.com.cn/">CFCA</a>、<a href="http://www.itrus.com.cn/conduct/">天威诚信</a>、<a href="https://www.trustasia.com/?ref=yulian">亚洲诚信</a>等</p>

<p>国外： <a href="https://helpx.adobe.com/acrobat/kb/approved-trust-list1.html">Adobe信任的证书颁发机构</a></p>
</blockquote>

<p><code>CFCA</code>:<a href="http://www.cfca.com.cn/">中国金融认证中心（China Financial Certification Authority，简称CFCA）</a>是经中国人民银行和国家信息安全管理机构批准成立的国家级权威安全认证机构，是国家重要的金融信息安全基础设施之一。在《中华人民共和国电子签名法》颁布后，CFCA成为首批获得电子认证服务许可的电子认证服务机构之一。CFCA拥有中华人民共和国工业和信息化部颁发的资质证书：<a href="http://www.cfca.com.cn/20150806/101228237.html">电子认证服务许可证</a></p>

<p>CFCA提供一个<code>CFCA证书注册审核系统</code>(简称RA)的系统，此系统部署在企业，可用于企业自己操作生成CFCA签名的个人证书，此系统通过安全网络通道连接至CFCA机房，在线通过CFCA根证书颁发个人证书，然后返回RA系统。通过此系统获得的个人证书属于CFCA直接颁发的证书，和个人直接在CFCA申请的证书一样。详细请见<a href="http://www.cfca.com.cn/20150806/101228278.html">http://www.cfca.com.cn/20150806/101228278.html</a></p>

<h3 id="toc_9">分发证书方式：</h3>

<blockquote>
<p>发送邮件链接形式分发。
用户接收后，加密后存入EFB，供后续签名使用。</p>
</blockquote>

<h3 id="toc_10">签名PDF</h3>

<p>私钥和证书导入EFB后，飞行员点击签名时调用PSPDFKit API为PDF进行签名,PSPDFKit 签名符合<a href="https://www.adobe.com/devnet-docs/acrobatetk/tools/DigSig/Acrobat_DigitalSignatures_in_PDF.pdf">Adobe Digital Signatures in a PDF</a>签名标准。
了解更多PSPDF电子签名相关信息请移步<a href="https://pspdfkit.com/guides/ios/6.9/features/digital-signatures/?search=digis">PSPDFKit digital-signatures</a></p>

<p><code>前端签名实现</code></p>

<div><pre><code class="language-none">// p12Data is an p12 archive NSData object
PSPDFPKCS12 *p12 = [[PSPDFPKCS12 alloc] initWithData:p12Data];

// Create a signer with a display name. the display name will shop up in the list of identities when you tap on a signature form field
PSPDFPKCS12Signer *p12Signer = [[PSPDFPKCS12Signer alloc] initWithDisplayName:@&quot;John Appleseed&quot; PKCS12:p12];

// Finally register your signer with the signature manager
PSPDFSignatureManager *signatureManager = PSPDFKit.sharedInstance.signatureManager;
[signatureManager registerSigner:p12Signer];


// Load a certificate (with a public key) from a p7 archive
NSData *certificateData = [NSData dataWithContentsOfURL:p7URL];

NSError *error = nil;
NSArray *certificates = [PSPDFX509 certificatesFromPKCS7Data:certData error:&amp;err];

// Don&#39;t forget to check for errors here

for (PSPDFX509 *certificate in certificates) {
    [signatureManager addTrustedCertificate:certificate];
}
</code></pre></div>

<p>签名后的PDF含有以下信息：个人的证书、签名字符串、PDF内容</p>

<p><a name="验证PDF是否被篡改过"></a></p>

<h3 id="toc_11">验证签名是否有效方法：</h3>

<p>原理如下：
<img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmnci4hsfqj31lw0va7fb.jpg" alt=""></p>

<p><a href="https://www.tsign.cn/static/page/main-page-verify.html">e-qianbao-PDF Verify</a></p>

<p><a href="https://helpx.adobe.com/acrobat/11/using/validating-digital-signatures.html">Adobe acrobat validating-digital-signatures</a></p>

<p><a href="https://pspdfkit.com/guides/ios/6.9/features/digital-signatures/?search=digis#toc_how-does-adobe-acrobat-validate-a-document-signed-by-pspdfkit">validate-a-document-signed-by-pspdfkit</a></p>

<h3 id="toc_12">电子取证</h3>

<p><img src="https://ws1.sinaimg.cn/large/00663vn1ly1fmpc4zxjnlj30x40fgdl5.jpg" alt=""></p>

<p>附录：</p>

<p><a href="http://www.miit.gov.cn/n1146285/n1146352/n3054355/n3057254/n3057259/c3868973/content.html">中华人民共和国电子签名法（2015年修正）</a></p>

<p><a href="http://7xiwr4.com1.z0.glb.clouddn.com/%E7%94%B5%E5%AD%90%E7%AD%BE%E5%90%8D%E3%80%81%E7%94%B5%E5%AD%90%E8%AE%B0%E5%BD%95%E5%AD%98%E6%A1%A3%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%94%B5%E5%AD%90%E6%89%8B%E5%86%8C%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%8E%A5%E5%8F%97%E4%B8%8E%E4%BD%BF%E7%94%A8.pdf">中国民用航空局飞行标准司-关于电子签名的咨询通告</a></p>




</body>

</html>
